"use strict";(self.webpackChunkhwdoc=self.webpackChunkhwdoc||[]).push([[3704],{5151:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var s=r(4848),t=r(8453);const l={},o="\u5b89\u88c5Let's Encrypt\u7684ssl\u8bc1\u4e66",c={id:"\u540e\u7aef\u5f00\u53d1/\u5b89\u88c5LetsEncrypt\u7684ssl\u8bc1\u4e66",title:"\u5b89\u88c5Let's Encrypt\u7684ssl\u8bc1\u4e66",description:"\u7b80\u4ecb",source:"@site/docs/\u540e\u7aef\u5f00\u53d1/\u5b89\u88c5LetsEncrypt\u7684ssl\u8bc1\u4e66.md",sourceDirName:"\u540e\u7aef\u5f00\u53d1",slug:"/\u540e\u7aef\u5f00\u53d1/\u5b89\u88c5LetsEncrypt\u7684ssl\u8bc1\u4e66",permalink:"/docs/\u540e\u7aef\u5f00\u53d1/\u5b89\u88c5LetsEncrypt\u7684ssl\u8bc1\u4e66",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u540e\u7aef\u5f00\u53d1/\u5b89\u88c5LetsEncrypt\u7684ssl\u8bc1\u4e66.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Wireshark\u6293\u5305\u8c03\u8bd5",permalink:"/docs/\u540e\u7aef\u5f00\u53d1/wireshark"},next:{title:"\u5b9d\u5854\u975eroot\u7528\u6237\u6267\u884c\u811a\u672c",permalink:"/docs/\u540e\u7aef\u5f00\u53d1/\u5b9d\u5854\u975eroot\u7528\u6237\u6267\u884c\u811a\u672c"}},i={},d=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"\u5b89\u88c5\u6559\u7a0b",id:"\u5b89\u88c5\u6559\u7a0b",level:2},{value:"\u5b89\u88c5snapd",id:"\u5b89\u88c5snapd",level:3},{value:"\u5b89\u88c5certbot",id:"\u5b89\u88c5certbot",level:3},{value:"Nginx\u914d\u7f6e",id:"nginx\u914d\u7f6e",level:3}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"\u5b89\u88c5lets-encrypt\u7684ssl\u8bc1\u4e66",children:"\u5b89\u88c5Let's Encrypt\u7684ssl\u8bc1\u4e66"}),"\n",(0,s.jsx)(e.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,s.jsx)(e.p,{children:"Let's Encrypt \u662f\u4e00\u4e2a\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\uff08Certificate Authority, CA\uff09\uff0c\u5176\u4e3b\u8981\u76ee\u6807\u662f\u901a\u8fc7\u81ea\u52a8\u5316\u6d41\u7a0b\u7b80\u5316\u5e76\u666e\u53ca\u4e07\u7ef4\u7f51\u670d\u52a1\u5668\u7684\u52a0\u5bc6\u8fde\u63a5\uff0c\u5c24\u5176\u662f\u4e3a\u7f51\u7ad9\u514d\u8d39\u63d0\u4f9bSSL/TLS\u8bc1\u4e66\uff0c\u4ee5\u63a8\u52a8\u5168\u7403\u8303\u56f4\u5185HTTPS\u7684\u5e7f\u6cdb\u91c7\u7528\uff0c\u4ece\u800c\u589e\u5f3a\u7f51\u7edc\u5b89\u5168\u6027\u548c\u7528\u6237\u9690\u79c1\u4fdd\u62a4\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b98\u7f51\u5730\u5740"}),"\r\n",(0,s.jsx)(e.a,{href:"https://certbot.eff.org/instructions?ws=nginx&os=centosrhel7",children:"https://certbot.eff.org/instructions?ws=nginx&os=centosrhel7"})]}),"\n",(0,s.jsx)(e.h2,{id:"\u5b89\u88c5\u6559\u7a0b",children:"\u5b89\u88c5\u6559\u7a0b"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5snapd",children:"\u5b89\u88c5snapd"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u9996\u5148\uff0c\u786e\u4fdd\u7cfb\u7edf\u4e0a\u5df2\u5b89\u88c5 ",(0,s.jsx)(e.code,{children:"epel-release"})," \u548c ",(0,s.jsx)(e.code,{children:"yum-utils"}),"\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo yum install epel-release\r\nsudo yum install yum-utils\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsxs)(e.li,{children:["\u6dfb\u52a0 ",(0,s.jsx)(e.code,{children:"snapd"})," \u7684\u5b58\u50a8\u5e93\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo yum-config-manager --add-repo https://raw.githubusercontent.com/springdalelinux/springdale-stable/7/dsf/springdale-stable.repo\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsxs)(e.li,{children:["\u5b89\u88c5 ",(0,s.jsx)(e.code,{children:"snapd"}),"\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo yum install snapd\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"4",children:["\n",(0,s.jsxs)(e.li,{children:["\u542f\u7528 ",(0,s.jsx)(e.code,{children:"snapd"}),"\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo systemctl enable --now snapd.socket\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"5",children:["\n",(0,s.jsxs)(e.li,{children:["\u66f4\u65b0 ",(0,s.jsx)(e.code,{children:"snapd"}),"\uff1a"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo snap install core; sudo snap refresh core\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u73b0\u5728\uff0c",(0,s.jsx)(e.code,{children:"snapd"})," \u5df2\u7ecf\u5b89\u88c5\u5e76\u51c6\u5907\u597d\u4f7f\u7528\u4e86\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,s.jsx)(e.code,{children:"snap"})," \u547d\u4ee4\u6765\u5b89\u88c5\u548c\u7ba1\u7406\u5305\uff0c\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"sudo snap install hello-world\r\nhello-world\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5certbot",children:"\u5b89\u88c5certbot"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"# \u5efa\u7acb\u8f6f\u8fde\u63a5\r\nsudo ln -s /var/lib/snapd/snap /snap\r\n\r\n# \u5b89\u88c5 certbot\r\nsudo snap install --classic certbot\r\n\r\n# \u5efa\u7acb\u8f6f\u8fde\u63a5\r\nsudo ln -s /snap/bin/certbot /usr/bin/certbot\r\n\r\n# \u83b7\u53d6\u8bc1\u4e66\u5e76\u81ea\u52a8\u914d\u7f6e nginx\r\nsudo certbot --nginx\r\n\r\n# \u4ec5\u83b7\u53d6\u8bc1\u4e66\uff0c\u624b\u52a8\u914d\u7f6enginx\r\nsudo certbot certonly --nginx\r\n\r\n# \u6307\u5b9anginx\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\r\nsudo certbot certonly --nginx --nginx-server-root=/www/server/nginx/conf/\r\n\r\n# \u542f\u52a8\u5b9a\u65f6\u4efb\u52a1\u81ea\u52a8\u7eed\u8ba2\u8bc1\u4e66\r\nsudo certbot renew --dry-run\n"})}),"\n",(0,s.jsx)(e.h3,{id:"nginx\u914d\u7f6e",children:"Nginx\u914d\u7f6e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:'server\r\n{\r\n    listen 80;\r\n\tlisten 443 ssl http2;\r\n    server_name www.he94.com he94.com;\r\n    index index.php index.html index.htm default.php default.htm default.html;\r\n    root /www/wwwroot/www.he94.com/web;\r\n    \r\n    #SSL-START SSL\u76f8\u5173\u914d\u7f6e\uff0c\u8bf7\u52ff\u5220\u9664\u6216\u4fee\u6539\u4e0b\u4e00\u884c\u5e26\u6ce8\u91ca\u7684404\u89c4\u5219\r\n    #error_page 404/404.html;\r\n    #HTTP_TO_HTTPS_START\r\n    if ($server_port !~ 443){\r\n        rewrite ^(/.*)$ https://$host$1 permanent;\r\n    }\r\n    #HTTP_TO_HTTPS_END\r\n    ssl_certificate    /www/server/panel/vhost/cert/www.he94.com/fullchain.pem;\r\n    ssl_certificate_key    /www/server/panel/vhost/cert/www.he94.com/privkey.pem;\r\n    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;\r\n    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;\r\n    ssl_prefer_server_ciphers on;\r\n    ssl_session_cache shared:SSL:10m;\r\n    ssl_session_timeout 10m;\r\n    add_header Strict-Transport-Security "max-age=31536000";\r\n    error_page 497  https://$host$request_uri;\r\n\r\n    #SSL-END\r\n    \r\n    #ERROR-PAGE-START  \u9519\u8bef\u9875\u914d\u7f6e\uff0c\u53ef\u4ee5\u6ce8\u91ca\u3001\u5220\u9664\u6216\u4fee\u6539\r\n    #error_page 404 /404.html;\r\n    #error_page 502 /502.html;\r\n    #ERROR-PAGE-END\r\n    \r\n    #PHP-INFO-START  PHP\u5f15\u7528\u914d\u7f6e\uff0c\u53ef\u4ee5\u6ce8\u91ca\u6216\u4fee\u6539\r\n    include enable-php-72.conf;\r\n    #PHP-INFO-END\r\n    \r\n    #REWRITE-START URL\u91cd\u5199\u89c4\u5219\u5f15\u7528,\u4fee\u6539\u540e\u5c06\u5bfc\u81f4\u9762\u677f\u8bbe\u7f6e\u7684\u4f2a\u9759\u6001\u89c4\u5219\u5931\u6548\r\n    include /www/server/panel/vhost/rewrite/www.he94.com.conf;\r\n    #REWRITE-END\r\n    \r\n    #\u7981\u6b62\u8bbf\u95ee\u7684\u6587\u4ef6\u6216\u76ee\u5f55\r\n    location ~ ^/(\\.user.ini|\\.htaccess|\\.git|\\.svn|\\.project|LICENSE|README.md)\r\n    {\r\n        return 404;\r\n    }\r\n    \r\n    #\u4e00\u952e\u7533\u8bf7SSL\u8bc1\u4e66\u9a8c\u8bc1\u76ee\u5f55\u76f8\u5173\u8bbe\u7f6e\r\n    location ~ \\.well-known{\r\n        allow all;\r\n    }\r\n    \r\n    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$\r\n    {\r\n        expires      30d;\r\n        error_log /dev/null;\r\n        access_log /dev/null;\r\n    }\r\n    \r\n    location ~ .*\\.(js|css)?$\r\n    {\r\n        expires      12h;\r\n        error_log /dev/null;\r\n        access_log /dev/null; \r\n    }\r\n    access_log  /www/wwwlogs/www.he94.com.log;\r\n    error_log  /www/wwwlogs/www.he94.com.error.log;\r\n}\n'})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>c});var s=r(6540);const t={},l=s.createContext(t);function o(n){const e=s.useContext(l);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);